<head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.3.2/html2canvas.min.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.3.1/jspdf.umd.min.js"></script>
</head>

<div id="pdf-content">

<div class="text-center">
    <h1><%= Time.now.year %> ACM Response and Disclosure Form
    </h1>
</div>

  <div class="container text-center">
  <div class="row">
    <div class="col">
      <div class="form-group">
        <label for="fullName">Full Name</label>
        <input type="text" class="form-control" id="fullName" placeholder="Full Name">
      </div>
    </div>
    <div class="col">
      <div class="form-group">
        <label for="rvp">Who is your RVP?</label>
        <select class="form-control" id="rvp" name="rvp">
      <option value="rvp1">RVP 1</option>
      <option value="rvp2">RVP 2</option>
      <!-- Add more RVP options as needed -->
    </select>
      </div>
    </div>
    <div class="col">
      <div class="form-group">
        <label for="solutionNumber">Rep Solution Number</label>
        <input type="text" class="form-control" id="solutionNumber" placeholder="5 Digit Solution Number">
      </div>
    </div>
  </div>
</div>

<div class="container text-center">
  <div class="box p-4 rounded border border-primary text-center">
    <h2>Annual Compliance Meeting <%= Time.now.year %> (Life)</h2>
    <p>I have reviewed and understand the compliance rules and regulations noted in the Annual Compliance Meeting presentation, have completed the Annual Compliance Section of the Program, and have reviewed the Representations for Primerica Representatives published with the Workbook on POL. Any representation that I cannot make is noted on the Disclosure and/or Discrepancies form on the back of this page with a brief explanation. â€“ Use the lines at the bottom of the form and/or a separate sheet.</p>
    <ul>
      <li>
        I have new disclosures and/or discrepancies to report that have not been previously reported to Primerica, and I have done so on the <%= Time.now.year %> ACM Disclosure and/or Discrepancies form (located on the back of this page).
      </li>
    </ul>
  </div>
</div>
  <div class="container">
    <p>
    By signing below, I certify that I have personally attended and correctly completed the <%= Time.now.year %> Annual Compliance Meeting, as required by the licenses I hold or the products I sell. My signature makes me accountable for compliance with the law and with Primerica ethics and compliance policies. I will use due diligence to ensure that my business conduct, the conduct of those I supervise, and the business conduct of my associates, is in compliance with the law and with Primerica policy.
    </p>

    <p>
    By signing below, I also certify that I have read and accurately completed the <%= Time.now.year %> ACM Disclosure and/or Discrepancies (if applicable) on the reverse side of this form.
    </p>

    <p>
    I will report any suspected violation of a law, regulation or Primerica compliance standard, and any request made of me to do anything improper or illegal, to my upline RVP, to my OSJA and to appropriate members of the Office of the General Counsel. I have reported any such matters arising in <%= Time.now.year %> to such persons. Any disclosures not previously made to such persons are included in detail on the reverse side on the Disclosures and/or Discrepancies form.
    </p>

    <p>
    I will require of myself, and will expect from my fellow Reps, the highest level of ethical conduct.
    </p>
  </div>

  <div class="container text-center">
    <div class="row">
      <div class="col">
          <input type="text" class="form-control cursive-input" id="repSignature" placeholder="John Doe" required>
          <p>Rep's E-Signature</p>
          <input type="text" class="form-control" id="exampleFormControlInput1" placeholder="Rep's Name">
          <p>Rep's Printed Name (as signed)</p>
         <input type="date" class="form-control" id="todaysDate" placeholder="Today's Date">
          <p>Today's Date</p> 
      </div>

      <div class="col">
        <input type="text" class="form-control" id="exampleFormControlInput1" placeholder="AMC Proctor's Name">
       <p>AMC Proctor's Name</p> 
       <input type="text" class="form-control" id="exampleFormControlInput1" placeholder="Date of ACM Completion">
          <p>Date of ACM Completion</p> 
      </div>

  <div class="text-center">
    <h5><%= Time.now.year %> ACM DISCLOSURES AND/OR DISCREPANCIES
    </h5>
  </div>

  <div class="container">
      <p>Use this form to explain Representation(s) as outlined in the respective section of the <%= Time.now.year %> Workbook (published on POL) for products which you are authorized to represent and that you do not meet in the year <%= Time.now.year %> or that you do not agree to meet. Be sure to provide any available supporting documents, which may include, but not be limited to, court orders, written procedures, authorizations, lists of individuals involved, addresses and phone numbers for individuals involved. If you report disclosures or discrepancies on this form, you must provide your RVP with a copy. Call the Compliance Help Desk at 1-800-243-8901 with any questions regarding discrepancies/disclosures.
      </p>
      <p>
      Your signature on the first part of the form certifies the accuracy of the information on this page.
      </p>
  </div>

<div class="box p-4 rounded border border-primary text-center">
    <p>Check the applicable disclosure(s) you are making and follow the additional instructions:</p>
      <div class="row">
        <div class="col-md-6">
          <div class="form-check">
            <%= check_box_tag 'home_address_change', '1', false, class: 'form-check-input' %>
            <%= label_tag 'home_address_change', 'Home address change' %>
          </div>
        </div>

        <div class="col-md-6">
          <div class="form-check">
            <%= check_box_tag 'employment_change', '1', false, class: 'form-check-input' %>
            <%= label_tag 'employment_change', 'Changes in employment which may constitute a conflict of interest (refer to Conflict of Interest Chart on POL > Compliance > Quick Links > OBA/PST > Chart of Potential Conflicts of Interest)
            For the item listed directly above, a written explanation of the facts must also be completed and attached.' %>
          </div>
      </div>

      <br>
      <br>

      <div class="row">
        <div class="col-md-6">
          <div class="form-check">
            <%= check_box_tag 'employment_change_1', '1', false, class: 'form-check-input' %>
            <%= label_tag 'employment_change_1', 'Bankruptcy, Judgment, or Lien' %>
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-check">
            <%= check_box_tag 'employment_change_2', '1', false, class: 'form-check-input' %>
            <%= label_tag 'employment_change_2', 'Regulatory Action' %>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6">
          <div class="form-check">
            <%= check_box_tag 'employment_change_1', '1', false, class: 'form-check-input' %>
            <%= label_tag 'employment_change_1', 'Civil Suit' %>
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-check">
            <%= check_box_tag 'employment_change_2', '1', false, class: 'form-check-input' %>
            <%= label_tag 'employment_change_2', 'Misdemeanor or Felony Charge(s) and/or Conviction(s)' %>
          </div>
        </div>
      </div>
    <p>For all items listed directly above, you must attach certified copies of the related legal documents, along with a written explanation of the facts.</p>

    <input type="text" class="form-control" id="exampleFormControlInput1" placeholder="Insert additional details here.">
</div>

<button id="download">Download as PDF</button>

</div>

</div>


<script>
// Get the input element
const todayDateInput = document.getElementById('todaysDate');

// Create a new Date object with the current date in the user's local time zone
const currentDate = new Date();

// Get the year, month, and day
const year = currentDate.getFullYear();
const month = String(currentDate.getMonth() + 1).padStart(2, '0'); // January is 0
const day = String(currentDate.getDate()).padStart(2, '0');

// Format the date as "YYYY-MM-DD"
const formattedDate = `${year}-${month}-${day}`;

// Set the default value of the input field to the current date
todayDateInput.value = formattedDate;

document.getElementById('download').addEventListener('click', () => {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF('portrait', 'mm', 'a4');

  const content = document.getElementById('pdf-content');
  if (!content) {
    alert('Content not found');
    return;
  }

  const fullName = document.getElementById('fullName').value; // Get the full name
  const repSignature = document.getElementById('repSignature').value; // Get the value of the required field
  const selectedRVP = document.getElementById('rvp').value; // Get the selected RVP

  // Check if the required field is filled out
  if (!repSignature) {
    alert("Rep's E-Signature is required before downloading.");
    return;
  }

  document.getElementById('download').style.visibility = 'hidden';

  html2canvas(content, { scale: window.devicePixelRatio }).then(canvas => {
    const imgWidth = 210; // A4 width in mm
    const imgHeight = canvas.height * imgWidth / canvas.width;
    const x = 0;
    const y = 0;

    const imgData = canvas.toDataURL('image/png');
    doc.addImage(imgData, 'PNG', x, y, imgWidth, imgHeight);

    // Get today's date in the desired format (e.g., "YYYY-MM-DD")
    const todayDate = new Date().toLocaleDateString('en-US');

    // Set the filename for the downloaded PDF with today's date appended
    const filename = `${fullName} ACM Form ${todayDate}.pdf`;

    // Save the PDF with the specified filename
    doc.save(filename);
    
    // Send the selected RVP and PDF data to your server to save in the database
    savePDFToDatabase(selectedRVP, doc.output('blob')).then(response => {
      // Handle the server response here, e.g., show a confirmation message
      
      // Provide a link for the user to download the PDF
      const downloadLink = document.createElement('a');
      downloadLink.href = URL.createObjectURL(doc.output('blob'));
      downloadLink.download = filename; // Set the filename
      downloadLink.textContent = 'Download PDF';
      document.body.appendChild(downloadLink);
      downloadLink.click();
      document.body.removeChild(downloadLink);
      
      document.getElementById('download').style.visibility = 'visible';
    }).catch(error => {
      // Handle any errors
      console.error('Error saving PDF:', error);
      document.getElementById('download').style.visibility = 'visible';
    });
  }).catch(err => {
    console.error('Error generating canvas:', err);
    document.getElementById('download').style.visibility = 'visible';
  });
});

function savePDFToDatabase(rvp, pdfBlob) {
  // Implement an HTTP request to send the selected RVP and PDF data to your server
  // You'll need to handle this server-side to save the PDF in your database
  // Example using fetch:
  return fetch('/save-pdf', {
    method: 'POST',
    body: JSON.stringify({ rvp, pdfBlob }),
    headers: {
      'Content-Type': 'application/json',
    },
  }).then(response => response.json());
}
</script>