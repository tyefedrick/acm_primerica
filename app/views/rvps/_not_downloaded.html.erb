<%= form_tag download_selected_pdfs_path, method: :post do %>
  <%= submit_tag "Download Selected as ZIP", class: "btn btn-info mt-2" %>
  <% pdfs.each do |pdf| %>
    <% unless pdf.downloaded_by?(current_user) %>
      <li class="list-group-item">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <%= check_box_tag "selected_files[]", pdf.id %>
            <%= "#{pdf.full_name} AMC Form #{pdf.formatted_date}.pdf" %>
          </div>
          <div>
            <%= link_to 'Download', download_pdf_path(pdf.id), class: 'btn btn-sm btn-primary download-individual', onclick: "handleIndividualDownload()" %>
          </div>
      </li>
    <% end %>
  <% end %>
  <%= submit_tag "Download Selected as ZIP", class: "btn btn-info mt-2" %>
<% end %>

<script>
document.addEventListener("DOMContentLoaded", function() {
  // Keep the ZIP download functionality as is
  Array.from(document.getElementsByTagName('form')).forEach(form => {
    form.onsubmit = async (e) => {
      e.preventDefault();
      await ajaxSubmitForm(form);
    };
  });
});

function handleIndividualDownload() {
  // Use setTimeout to delay the refresh, allowing the download to initiate
  setTimeout(() => {
    window.location.href = window.location.href; // Reload the page
  }, 250); // Adjust this delay as needed
}

async function ajaxSubmitForm(form) {
  // Implementation for handling form submission to download selected PDFs as ZIP
  // This remains unchanged from your working ZIP download functionality
}
</script>