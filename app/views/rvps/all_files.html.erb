<div class="container mt-4">
  <h1 class="mb-4">RVPs</h1>
  <ul class="list-group">
    <% @rvps.each do |rvp| %>
      <li class="list-group-item d-flex justify-content-between align-items-center">
        <%= link_to rvp.formatted_name, rvp_path(rvp.id), class: "mr-auto" %>
        <span class="favorite <%= rvp.favorite_by_user?(current_user) ? 'favorited' : '' %>" data-rvp-id="<%= rvp.id %>">
          â˜†
        </span>
      </li>
    <% end %>
  </ul>
</div>

<script>
  $(".favorites").on("click", function() {

    let rvpId = $(this).data("rvp-id")
    console.log("test")

    let isFavorite = "true"

    const token = document.querySelector('meta[name="csrf-token"]').getAttribute('content');

    fetch('/favorites/update', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRF-Token': token,
        },
        body: { rvp_id: rvpId, favorite: isFavorite },
    })
    .then(response => {
        if (!response.ok) {
            throw new Error(`HTTP Error! Status: ${response.status}`);
        }
        return response.json();
    })
    .then(data => {
        $(this).addClass("favorited")
    })
    .catch(error => {
        console.error("Error updating favorite status:", error);
    });
  })
</script>

<style>
  .arrow {
    display: inline-block;
    margin-right: 5px;
    transition: transform 0.3s ease;
  }
  .favorite {
    cursor: pointer;
    display: inline-block;
    margin-left: 10px;
  }
  .favorite.favorited {
    color: gold;
  }

  .favorite_rvp {
     list-style-type: none; /* This removes the bullet point */
  }
</style>