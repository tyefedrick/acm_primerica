<% pdfs.each do |pdf| %>
  <% if pdf.downloaded_by?(current_user) %>
    <!-- Display the form information -->
    <% full_name = pdf.full_name %> <!-- Get the full name from the PDF model -->
    <li>
      <%= check_box_tag "selected_files[]", pdf.id %> <!-- Remove the { checked: true } option -->
      <%= "#{full_name} AMC Form #{pdf.formatted_date}.pdf" %>
      <!-- Add a link to download the form -->
      <a href="<%= download_pdf_path(pdf.id) %>" class="download-link" data-pdf-id="<%= pdf.id %>" download>Download</a>
    </li>
  <% end %>
<% end %>

<!-- Include this script at the end of the page -->
<script>
  document.addEventListener("DOMContentLoaded", function() {
    // Add event listeners to all download links
    document.querySelectorAll('.download-link').forEach(function(link) {
      link.addEventListener('click', function(event) {
        // Prevent default behavior (i.e., following the link)
        event.preventDefault();

        // Get the ID of the PDF associated with this link
        var pdfId = this.getAttribute('data-pdf-id');

        // Allow the default behavior (downloading the file)
        // Trigger the download action
        window.location.href = link.href;

        // Simulate a page refresh after a short delay (adjust as needed)
        setTimeout(function() {
          location.reload();
        }, 1000); // Refresh after 1 second (1000 milliseconds)
      });
    });
  });
</script>